---
title: "Version 6.40"
date: 2022-05-13T15:32:31+03:00
draft: false
weight: 91
---

[OPEN PDF](https://storage.googleapis.com/twc-pedia-prod-bucket/pdf/relguides/CHQ%20Release%20Guide%20Version%206.40.165.0.pdf)

## Sales

### Extended search for customer records

`Build 6.40.46.0: PRO-6589`

Starting from version 6.40.46.0, customer search index has been extended to support customer search by External ID in POS PRO V6 app.

{{% notice info %}}
The **external ID** field contains a unique record identifier from a system outside Teamwork. For example, if the company creates a customer record in an external system and then imports the record into CHQ, the identifier from that external system is preserved as the **external ID** value.
{{% /notice %}}

In CHQ, the customer **external ID** field is available under `sales > customers > list > [your customer record] > edit > system`.

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual - Sales & eCommerce](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Gift Cards: Updated conditions for changing the reason code field

`Build 6.40.84.0: PRO-11597`

As of version 6.40.84.0, under `chq > sales > gift cards > list > [your gift card] > view/edit`, users can no longer change the value in the **reason code** field if the gift card has already been loaded. The **reason code** field indicates the reason for or purpose of issuing the gift card.

Now, the **reason code** field is only editable when:

- the user has **Add or edit Gift Cards area** security right, and
- the gift card status is not `deactivated` or `expired`, and
- there are no past transactions incrementing the balance of the gift card.

#### See also

[Cloud HQ User Manual - Sales & eCommerce](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Verified Return of Promo-Grouped Items

`Build 6.40.165.0: PRO-11692`

In version 6.40.165.0, we’ve introduced a new **grouped promo items partial return** setting used to control verified returns of items sold *as part* of a promotion group.

{{% notice note %}}
Previously, in Teamwork POS Version 4, it was only possible to return all items sold in a promo group.
{{% /notice %}}

#### How to configure
{{% notice warning %}}
Please be advised that the new setting applies to the following promo types:
- Buy X, Get Y
- Spend More, Get More
- Buy at Least X, Get Discount
- Buy Multiples of X, Get Discount
{{% /notice %}}

1. In CHQ, go to `sales > promotion engine`.
2. Click the existing promotion you want to edit.
{{% notice tip %}}
To add a new promotion, click **new** at the top of the screen. Then, select the required promo type and click **ok**.
{{% /notice %}}
3. In the dialog that opens, go to the **options** tab.
4. Make sure that the **promo returns** checkbox is selected. If not, select the checkbox for the **grouped promo items partial return** dropdown menu to display:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_promo1.jpg" width="600px"%}}
5. In the **grouped promo items partial return** dropdown menu, select the option you need:

    - `warn and allow`: allows the POS user to process any combination of returned items. In this case the following warning will display in POS: `Promotion Item. The item selected was sold as part of a grouped promotion`
    - `require all items returned together`: this option forces the POS user to return all items purchased on the promotion
6. **Save** your changes.

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual - Sales & eCommerce](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

## Purchasing

### Importing Carton Number during Custom ASN Import

`Build 6.40.150.0: PRO-13088`

As of version 6.40.150.0, we’ve introduced the capability to import carton numbers during Custom ASN Import. This resulted in adding the **Carton Number** field to the Custom ASN Import template in CHQ.

{{% notice note %}}
Please be advised that the custom ASN import is available on request only. Once configured, the ASN Import template option becomes available under `chq > purchasing > ASNs > import > new`.
{{% /notice %}}

Also, the **carton ID** field at the ASN item level (`chq > purchasing > ASNs > [your ASN] > items`) is now populated with the **Carton Number** value resulting from the import.
{{% notice tip %}}
As a part of this update, we’ve also added the **Carton ID** field to the ASN import template (`chq > purchasing > ASNs > import > new`).
{{% /notice %}}

#### See also

[Cloud HQ User Manual: Purchasing](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Carton Number is required in Custom ASN Import

`Build 6.40.159.0: DS-4136`

Starting from version 6.40.159.0, the **Carton Number** field is required in the *Custom* ASN Import template in CHQ.
{{% notice note %}}
Please be advised that the *custom* ASN import is available on request only. Once configured, the ASN Import template option becomes available under `chq > purchasing > ASNs > import > new`.
{{% /notice %}}

The value from **Carton Number** populates the **carton ID** field at the ASN line item level.

#### See also

[Cloud HQ User Manual: Purchasing](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

## Services

### Configuring the display of Sales Receipt details on Adyen terminal

`Build 6.40.46.0: PRO-9662`

Starting from version 6.40.46.0, users can enable the display of receipt details on the Adyen terminal. This update allows POS PRO users to show the customer an overview of their purchase when processing a Sales Receipt.

Respectively, a new **enable shopper display** setting has been added in CHQ under `services > device controller > app settings`. If the setting is enabled, receipt details are sent to the connected terminal when the user opens the **Payment** area in POS PRO.

#### How to enable receipt display on the Adyen terminal

1. In CHQ, go to `services > device controller`.
2. Find your device and click it.
3. In the **edit device** dialog that opens, go to the **app settings** tab.
4. Make sure that, under the **payment terminal** section, settings related to Adyen integration are properly configured.
5. Select the new **enable shopper display** checkbox (clear by default):
{{% gimg src="V6.40 CHQ Release Guide/640_chq_adyen1.jpg" title="New settings in the Givex section" width="600px"%}}

6. **Save** the changes.
{{% notice note %}}
Please note that the **enable shopper display** setting can be configured both in CHQ and POS PRO. The state of the setting is synchronized between the two.
{{% /notice %}}

#### See also

[V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)

### Automatic RFID network connection

`Build 6.40.46.0: PRO-8156`

As of version 6.40.46.0, network connection for RFID readers is established automatically.

In particular, if the Ethernet cable is plugged into the device, the RFID reader utilizes Ethernet connection. Alternatively, if the Ethernet cable is disconnected, network connection type is automatically switched to Wi-Fi.

The implementation of this logic resulted in removing the **connection type** setting previously available for the RFID reader under `chq > services > device controller > [your device record] > app settings > the RFID reader section`.

#### See also

[V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)

## Settings

### Givex gift cards: Extended capabilities

`Build 6.40.46.0: PRO-10159`

In CHQ, we've added the following new capabilities related to Givex gift cards:

- setting Givex as the gift card processor for physical gift cards
- defining the minimum and maximum amounts that can be loaded on a new gift card
- selecting Givex as the processor for a **check balance** payment method

{{% notice note %}}
As of version 6.40.46.0, extended Givex gift card capabilities have not been implemented in the POS PRO app. In CHQ, the settings described below have been added in advance and should not be configured by users until the implementation of Givex extended functionality is completed for POS.
{{% /notice %}}

#### How to set Givex as the processor for a physical gift card

For a gift card to be processed via Givex, the latter must be selected as the gift card processor for the service item representing that gift card in the inventory. To set Givex as the processor:

1. In CHQ, go to `inventory > styles & items`.
2. Create a new service item or find and open the existing service item that represents your gift card.
3. In the dialog that opens, in the **control & usage** section of the **general** tab, make sure that the following is configured:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_givex4.jpg" title="New settings in the Givex section" width="600px"%}}

    - **item classification**=`charge` ({{% inum "A" %}})
    - **charge type**=`physical gift card`({{% inum "B" %}})

4. In the new **gift card processor** field ({{% inum "C" %}} in the screenshot above), select `GiveX`.
5. **Save** your changes.

#### How to define balance limits for new Givex gift cards at the company level

It's possible to set the minimum and maximum amounts that the user can load on a new Givex gift card sold in POS PRO. To do so at the company level:

1. In CHQ, go to `settings > sales > payment processing`.
2. Scroll down to the **givex** section.
{{% gimg src="V6.40 CHQ Release Guide/640_chq_givex1.jpg" title="New settings in the Givex section" width="600px"%}}
3. Populate the following new settings:

    - **minimum gift card sell amount**
    - **maximum gift card sell amount**

4. **Save** your changes.

#### How to define balance limits for new Givex gift cards at the location level

1. In CHQ, go to `settings > location settings > locations / location settings`.
2. Click to select your location, then click **edit**.
3. In the **[selected location]** dialog that opens, go to the **payments** tab.
4. Scroll down to the **payment processing - Givex** section.
5. Populate the following settings:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_givex2.jpg" title="New settings in the Givex section" width="400px"%}}
    - **minimum gift card sell amount**
    - **maximum gift card sell amount**

6. **Save** your changes.

#### How to set Givex as the processor for gift card balance check

For users to be able to check the balance of a Givex gift card in POS PRO, a **check balance** payment method must be set up in CHQ with Givex selected as the payment processor. To set Givex as the payment processor:

1. In CHQ, go to `settings > sales > payment methods`.
2. In the area that opens, select your **check balance payment** method.
3. Above the grid, click the **location settings** button.
4. In the dialog that opens, select the required location.
5. Click **edit**.
6. In the dialog that opens, select `Givex` in the **payment processing** field:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_givex3.jpg" title="New payment processing field" width="400px"%}}
7. **Save** your changes.

#### See also

- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")
- [Cloud HQ User Manual: Sales & eCommerce](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Configuring settings for return gift cards

`Build 6.40.46.0: PRO-9776`

In CHQ, it's now possible to configure settings for gift cards that are issued as a means of refund. These settings are separate from the settings for gift cards that are sold to customers.

To support this functionality, we've added settings for return gift cards at the fiscal zone and country levels.

#### Purpose

This enhancement provides the capability to set distinct rules for generation of return gift cards. For example, for such gift cards, the company may want to define an expiration date different from the expiration date of regular gift cards.

#### Updates at the fiscal zone level

In CHQ, under `settings > company settings > credit & reward platform > fiscal zones > [selected fiscal zone] > edit > gift cards` the following changes have been made:

1. The existing **defaults** section has been renamed to **gift cards sold** ({{% inum "A" %}} in the screenshot below). Now, the settings in this section apply only to Teamwork gift cards that are sold to customers.
2. A new **gift cards for returns** section has been added ({{% inum "B" %}} in the screenshot below). The settings in this section apply to Teamwork gift cards that are issued as a means of refund when merchandise is returned.  
{{% gimg src="V6.40 CHQ Release Guide/640_chq_GC1.jpg" title="New section at the fiscal zone level" width="600px"%}}
The **gift cards for returns** section includes the following settings:

    - **allow balance transfer**: allows for transferring balance between return Gift Cards
    - **allow balance recharge**: allows for loading value on existing active return gift cards
    - **expiration policy**: defines how a return gift card should expire. Possible values are `no expiration`, `period (months)`, and `period (days)`
    - **expiration period (days)/(months)**: the number of days/months after which return gift cards expire
    - **grace period (days)**: a period within which an expired gift card is still accepted by the retailer

#### Updates at the country level

In CHQ under `settings > company settings > countries / regions > [selected country] > edit > general`, the following updates were made:  

1. All existing gift card settings except for the **require customer on receipt for emailing options** checkbox have been moved from the **gift card defaults** to the new **gift cards sold** section ({{% inum "A" %}}).
{{% gimg src="V6.40 CHQ Release Guide/640_chq_GC2.jpg" title="New section at the country level" width="600px"%}}
2. A new **gift cards for returns** section ({{% inum "B" %}}) has been added with the following settings available:

    - **use country/region based gift card defaults**: if this checkbox is selected, the country-level gift card settings are used over the fiscal zone level settings. On selecting, the remaining settings in the **gift cards for returns** section become available. Clear by default
    - **expiration policy**: defines how a return gift card should expire. Possible values are `no expiration`, `period (days)`, and `period (months)`
    - **expiration period (days)/(months)**: the number of days/months after which the return gift card expire
    - **grace period (days)/(months)**: a period within which an expired gift card is still accepted by the retailer

#### Settings used for return virtual gift cards in Returns Manager

When a return is processed via the Returns Manager functionality, and the refund is made to a virtual gift card, either country-level or fiscal zone level settings may be used to create that virtual gift card.

In particular, country-level settings are used if:

- the **country** is defined on the gift card, and
- the **gift cards for returns - use country based gift card defaults** checkbox is selected under `chq > settings > company settings > countries / regions > [selected country] > edit > general > the *gift cards for returns section`.

Otherwise, fiscal zone level settings are used to create the return gift card.

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")
- [Returns Manager in CHQ Release Guide V6.33](https://twdocs.netlify.app/userdoc/chq/relguides/6.33_chq_relguide/#returns-manager)

### New transaction email type: Return Virtual Gift Card Delivery

`Build 6.40.46.0: PRO-10096, PRO-10313`

In CHQ, we've added a new `Return Virtual Gift Card Delivery` transaction email type.

This email type is used to send a customer the details of the Virtual Gift Card (VGC) issued to them as a means of refund. The email is sent after, in POS PRO, the user finalizes a receipt where a return VGC was issued with the **Card Delivery** option set to `Email Card Number`.

{{% notice note %}}
Please be advised that, in the `Return Virtual Gift Card Delivery` email, the FULL gift card number is available to the customer.
{{% /notice %}}

In CHQ, the `Return Virtual Gift Card Delivery` transaction email type is available for setup and configuration under `settings > company settings > transaction emailing`.

#### See also

[V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)

### Updated tag printing settings

`Build 6.40.46.0: PRO-10590, PRO-9575`

In V6 App Designer, we've added a new unified **Tag Printing** section that allows for configuring the **Print Tags** area in POS PRO.

The new **Tag Printing** section replaces previously existing **Catalog Tag Printing** and **Transaction Tag Printing** sections.

Additionally, we've made changes to the **item tag** section in the **edit device** dialog.

#### How to configure the Tag Printing area in the V6 App Designer

By configuring the **Tag Printing** area in V6 App Designer, users can define the layout of the **Print Tags** area in POS PRO. The **Print Tags** area appears when the user chooses to print item tags from Catalog or a document such as Transer In or Adjustment Memo.

To configure:

1. In CHQ, go to `settings > company settings > v6 App Designer`.
2. In the area that opens, choose `Point of Sale V6 > iPad > Tag Printing`:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_tagprinting1.jpg" title="New Tag Printing area in V6 App Designer" width="600px"%}}

3. Under **available fields**, find and then press and drag the label you need to the **layout** section.
{{% notice note %}}
Please note that the order of labels in the **layout** section defines the order in which they display in POS PRO.
{{% /notice %}}
Alternatively, to remove a field from the area, press the required label and then drag it out of the **layout** area.
4. Click **save**.

####  Updated print tag settings at the device level

In CHQ, under `services > device controller > [your device record] > printing options > the item tag section`, the following updates have been made::

- in the **type** field, `no print` option has been removed. Additionaly, `print` has been set to be the new default value
- the **printer**, **document template** and **number of copies** are no longer required fields.

#### See also

[V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)

### New security right for removing promotions

`Build 6.40.46.0: PRO-10879`

We've added the following new security right:

Area | Right | Description |
:----------- |:----------- |:----------- |
Sales | Allow removing promotion | Allows a user to manually remove a promotion from the transaction|

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Configuring additional user login for performing returns

`Build 6.40.46.0: PRO-9551`

In version 6.40.46.0, we've added the capability to require a second user login in POS PRO to validate all returns for users with limited rights for returns.

In CHQ, users can enable this functionality by configuring the **require second login for returns** setting.

Additionally, a new **Sales – Allow to verify return** security right has been added. This security right must be granted to users who validate returns in POS PRO.

#### Purpose

Requiring a second user to log in and thus validate a return in POS PRO allows for enhancing security and preventing possible fraud related to merchandise returns.

#### New security right

The user who validates a return in POS PRO must be granted the following security right:

Area | Right | Description |
:----------- |:----------- |:----------- |
Sales | Allow to verify return | Allows the user to login to verify a return |

Please note that users don't have this security right by default.

{{% notice note %}}
For information on how to assign security rights to users, see the **Roles** section of the [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6").
{{% /notice %}}

#### How to enable second user login for returns

For additional user login to be required in POS PRO, do the following:

1. In CHQ, go to `settings > location settings > locations / location settings`.
2. Click to select your location, then click **edit**.
3. In the **[selected location]** dialog that opens, go to the **sales** tab.
4. In the **sales** section, select the new **require second login for returns (V6)** checkbox:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_returns1.jpg" title="New require second login for returns (V6) setting" width="400px"%}}
5. **Save** your changes.

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Auto-issuing coupons to new customers

`Build 6.40.67.0: PRO-10997`

We've added the capability to issue coupons automatically when a new customer is being added in Teamwork.

To accomodate this capability, we've added new settings to the fiscal zone level.

Also, we've added the capability to select the **created at** location when adding a new customer record.

#### Purpose

This update allows for configuring coupon-related settings at the fiscal zone level. Once configured, the coupons can be automatically issued for new customers created within the specified fiscal zone.

Also, when creating a new customer record, the location should be specified in the **created at** field so that a new customer coupon will be issued automatically.

#### Creating a coupon for new customers at the fiscal zone level

We've added a new **events** tab to the fiscal zone dialog. On this tab, all the coupon-related settings are configured for newly created customers. To configure:

1. In CHQ, go to `settings > company settings > credit & reward platform > fiscal zones`.
2. Double click the required fiscal zone in the table.
3. In the dialog that opens, go to the new **events** tab.  
{{% gimg src="V6.40 CHQ Release Guide/640_chq_event_1.jpg" title="The events tab in the fiscal zone dialog" width="600px"%}}
On the **events** tab, use the search field at the top-right to find a specific event record. Searching is possible by the event's name.  
By clicking **filter** above the grid, you can filter the records by `active/inactive` status.  
Reviewing information on the selected event is possible by clicking **edit** above the grid.  
To remove the selected event, click **remove** above the grid.

4. To create a new event, click **new** above the table:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_event1.jpg" title="The events tab in the fiscal zone dialog" width="600px"%}}

5. In the **new event** dialog that opens, the following sections are available:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_event2.jpg" title="The events tab in the fiscal zone dialog" width="600px"%}}

    - **general**
    - **mailing settings**
    - **options**

In the **general** section, populate the following fields:

Field | Description | Value |
:----------- | :----------- | :----------- |
**name** | the name of the event | max 128 characters, required |
**description** | user-defined event description | max 512 characters |
**trigger** | the trigger of the event | `customer creation`, not editable |
**action** | the action that the event provides | `create coupon`, not editable |
**inactive** | if the checkbox is selected, the event is turned off | clear by default |

{{% notice note %}}
Please note that for the **trigger** and **action** fields, more options will be available in the future CHQ versions.
{{% /notice %}}

Below in the **mailing setting** section, populate the following fields:

Field | Description | Value |
:----------- | :----------- | :----------- |
**mailing service** | defines if an email should be sent and via which emailing service provider | available options: `Off` (default) and `Mandrill` |
**email template** | allows for selecting one of the email templates predefined on the Mandrill side | available if **mailing service** is `Mandrill`, required |
**sender email** | indicates the sender’s email | validated by Mandrill, required, empty by default |
**ignore subscription flag** | defines if the customer’s mailing preference is ignored when sending an email about the new customer coupon | selected by default |
**send instant** | defines if an email should be sent immediately or in a batch | clear by default |

{{% notice note %}}
Emails will not be sent if **mailing service** is `off` or the **primary email** (`chq > sales > customers > [selected customer] > general`) of the customer who’s linked to the coupon is empty.
Also, no email is sent if **ignore subscription flag** is clear and the **transactional** flag is cleared for **primary email** of the customer who’s linked to the coupon (`chq > sales > customers > [selected customer] > general`).
{{% /notice %}}

Then, in the **options** section, populate the following fields:

Field | Description | Value |
:----------- | :----------- | :----------- |
**coupon description** | the user-defined coupon description | max 512 characters, empty by default |
**coupon type** | defines the type of coupon received as a reward | possible values are: `amount`(set by default), `percentage` and `promo activation` |
**coupon value** | defines the value of the coupon | required if **coupon type**=`amount` or `percentage`; decimal, cannot be zero or negative; if **coupon type**=`percentage`, then max value is 100 % |
**coupon program** | allows for selecting one of the available programs to which the reward coupon will belong | required, empty by default {{% notice note %}}
If **coupon type** equals `amount` or `percentage`, it is not possible to select a coupon program where **discount type** is `promo discount`. Also, if **coupon type** equals `promo activation`, it is not possible to select a coupon program where **discount type** is `line discount` or `global discount`. {{% /notice %}} |
**coupon # generation mask** | allows for generating coupon # in a new coupon | empty by default |
**start date** | defines when the coupon is activated | possible values are `valid immediately`(set by default) and `delay`|
**start date delay (days)** | defines the number of delay days after which the coupon will be activated; visible and required if **start date**=`delay` | integer, possible values range from `1` to `999`, default is `0` |
**expiration policy** | defines if the coupon expires after a period of time | possible values are `no expiration` and `period`(default) |
**expiration period (days)** | defines after how many days the coupon expires. | visible and required if **expiration policy**=`period`; integer, possible values range from `1` to `999`, default is `0` |

{{% notice note %}}
Please note that settings of the **options** section are available for configuration when `create coupon` is defined for the **action** field in the **general** section of the **new event** dialog.
{{% /notice %}}

6. **Save** your changes.

#### Updates in the customer dialog

We've added the capability to define the location where the new customer record is being created.

To do so, in CHQ under `sales > customers > new > system`, select your location in the **created at** field:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_event3.jpg" title="The created at field in the new customer dialog" width="600px"%}}
{{% notice note %}}
Creating new customer records is also possible from the **sales order** and the **reserve order** dialogs:

- under `chq > sales > order management > new > customer > add customer > system`
- under `chq > inventory > reserve orders > new > general > add customer > system`.
{{% /notice %}}

#### See also

- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")
- [Cloud HQ User Manual - Sales & eCommerce](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### New security right for placing Adjustment Memos on hold

`Build 6.40.84.0: PRO-11550`

Starting from version 6.40.84.0, we’ve added the following new security right for POS PRO:

Area | Right | Description |
:----------- |:----------- |:----------- |
Adjustments | Allow held adjustments | Allows a user to place an Adjustment Memo on hold in POS PRO under `Home Screen > Adjustments > [selected Adjustment Memo]`.|

Additionally, only users granted with this right can change the hold reason in new as well as existing Adjustment Memos.

{{% notice note %}}
For information on how to assign security rights to users, see the **Roles** section of the [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6").
{{% /notice %}}

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Automatic posting of Transfer Memo In

`Build 6.40.84.0: PRO-11598`

We've introduced the capability to automatically post Transfer Memo In for the target location when posting Transfer Memo Out. In the Transfer Memo In, **qty in** for each item matches the **qty out**.

To do so:

1. In CHQ, go to `settings > location settings > locations / location settings`.
2. Click to select your location record and then click **edit**.
3. In the dialog that opens, go to the **transfers** tab.
4. Select the **automatically post transfer memo in** checkbox:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_transfer1.jpg" title="New automatically post transfer memo in checkbox" width="500px"%}}
5. **Save** your changes.

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### ShippyPro: Sending a "close" call for the shipment

`Build 6.40.111.0: PRO-11869`

We’ve added the capability to automatically send a "close" call to ShippyPro after the shipping label is retrieved for a Ship Memo in POS PRO. This resulted in adding a new **require closing** setting to CHQ.

Also, as a part of this update, the **require closing** column was added to the **configure methods – [your shipping service]** dialog.

#### Purpose

Some carrier services integrated with ShippyPro require a closing call to be sent in order to complete the shipment transaction and activate the tracking number.

If such a call is not received by the carrier, an additional fee may be applied to the shipment that hasn’t been closed.

If the **require closing** setting is enabled for the carrier service in CHQ, in POS PRO, the call is sent automatically right after the user retrieves the shipping label.

#### How to enable sending the closing call to ShippyPro

1. In CHQ, go to `settings > company settings > shipping services`.
2. Click to select **ShippyPro** in the table and then click **configure methods**.
3. In the **configure method – ShippyPro** dialog, click to select **[your shipping method]** (the required carrier service) and then **edit**.
4. In the dialog that opens, select the **require closing** checkbox:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_shm1.jpg" title="New require closing checkbox" width="400px"%}}
5. **Save** your changes.

#### New require closing column

The new **require closing** column is available under `chq > settings > company settings > shipping services > ShippyPro – configure methods`.

The column is not visible by default.

To add the **require closing** column to the table, right-click the table header and then select the **require closing** checkbox:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_shm2.jpg" title="New require closing checkbox" width="500px"%}}

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Shipping tax allowed on imported Sales Orders with free shipping

`Build 6.40.120.0: DS-3849`

We’ve made updates to allow for importing Sales Orders (SOs) with shipping tax where shipping fee is $0. To support this, we’ve removed the validation that previously required the imported SO to have a positive shipping fee for the shipping tax to be applied.

{{% notice note %}}
This update covers the case where, in some states, tax is levied on shipments even when shipping is free. Prior to version 6.40.120.0, it was not possible to create such SOs by import into CHQ due to the existing validation check.
{{% /notice %}}

### New security rights for changing validation on customer fields

`Build 6.40.120.0: PRO-12269`

As of version 6.40.120.0, we’ve added the following new security rights:

Application | Area | Right | Description |
:----------- |:----------- |:----------- |:----------- |
CloudHQ | Customers | Edit validation flags | In customer records in CHQ, users granted this security rights can configure the **validation** field against the following fields:<ul><li>**phone 1–4** (**mobile, home, work, other**)</li><li>**primary email**</li><li>**postal address**</li></ul>|
POS | Customers | Edit validation flags | In customer records in POS PRO, users granted this security rights can configure the **Validation** field against the following fields:<ul><li>**Phone 1–4** (**mobile, home, work, other**)</li><li>**Primary Email**</li><li>**Postal Address**</li></ul>|

{{% notice note %}}
The **validation** field indicates if the customer’s phone number, email, or postal address is valid and can be used for communications. Users can select `not checked`, `invalid`, or `valid`.
{{% /notice %}}

{{% notice info %}}
For information on how to assign security rights to users, see the **Roles** section of the [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6").
{{% /notice %}}

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Updated Customer URL field

`Build 6.40.120.0: PRO-12034`

We’ve changed the default name of the **Customer Profile Link** field to **Customer URL** across all CHQ areas.

Additionally, we’ve introduced the capability to set a custom name for the **Customer URL** field that will appear both in CHQ and POS PRO.

#### How to set a custom name for the Customer URL field

1. In CHQ, go to `settings > customer > customer settings`.
2. In the **general** section, populate the new **customer URL label** field:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_url1.jpg" title="New customer URL label field" width="550px"%}}
Note that up to 50 characters are allowed.

Additionally, to add a translation, click the *globe* icon next to the **customer URL label** field.
3. **Save** your changes.
{{% notice note %}}
If the customer URL label field is not populated, the default customer URL name appears in CHQ and POS PRO.
{{% /notice %}}

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Support of eCommerce Reserve Orders

`Build 6.40.132.0: PRO-12139`

Teamwork Commerce PRO suite now supports Reserve Orders (ROs) imported from an integrated eCommerce platform.

To accommodate this update, in CHQ, we’ve extended the Reserve Order functionality with the following capabilities:

- defining the default expiration period for ROs
- configuring if an email should be sent to the customer when releasing an RO
- setting up the **reserve** transaction emailing

#### Purpose

Support of eCommerce ROs allows users in POS PRO to fulfill item reservations made by customers via the integrated eCommerce website.

Imported ROs appear in POS PRO at the appropriate company location in the Held status. The store associate needs to prepare the required items for the customer and then confirm that by tapping **Release** in the Reserve Order.

CHQ allows for setting up a new **reserve** transaction email that can be sent to the customer when the RO is released. The email notifies the customer that the indicated items are reserved and ready for the customer’s review.

Additionally, CHQ now allows for assigning a default expiration period to ROs. For example, it’s possible to configure a distinct expiration period for Orders with the “eCommerce reservation” reserve reason. This way, if the customer hasn’t come to the store to pick up the reserved items, the RO will be automatically archived after the configured period.

#### How to set a default expiration period for ROs

1. In CHQ, go to `settings > inventory/catalog > reserve reasons`.
2. Click to select **[your reserve reason]** and then **edit**. Alternatively, click **new** to create a new reserve reason record.
3. In the dialog that opens, fill out the **default expiration period (hrs)** field:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_ro1.jpg" title="New default expiration period (hrs) field" width="400px"%}}
Note that decimal values from `0` to `999999.99` are allowed. By default, `0` is set meaning that no default expiration period is defined.
4. **Save** your changes.

#### Enabling email notifications for RO release

To enable sending an email to the customer when the RO is released:

1. In CHQ, go to `settings > inventory/catalog > reserve reasons`.
2. Click to select **[your reserve reason]** and then **edit**. Alternatively, click **new** to create a new reserve reason record.
3. In the dialog that opens, select the **send email notification for "reserve"** checkbox:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_ro3.jpg" title="New send email notification for reserve field" width="400px"%}}
4. **Save** your changes.

#### Setting up the reserve transaction email type

For a customer to be notified when the requested items are reserved, the reserve email type must be set up under `settings > company settings > transaction emailing`.

To create a new reserve email type, click **new** at the top-left. In the **new transaction emailing** dialog that opens, in the **type** field, make sure that `reserve` is selected:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_ro4.jpg" title="New reserve transaction email type" width="400px"%}}
Then, fill out the required fields and **save** your changes.

#### New columns in the reserve reasons area

As a part of this update, we’ve added the **default expiration period (hrs)** and **send email notification for "reserve"** columns under `chq > settings > inventory/catalog > reserve reasons`.

Note that the new columns are not visible by default. To add the columns to the table, right-click the table header and then select the **default expiration period (hrs)** and **send email notification for "reserve"** checkboxes:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_ro2.jpg" title="New columns in the reserve reasons area" width="500px"%}}

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Configuring allowed GTIN prefixes

`Build 6.40.132.0: PRO-12184`

As of version 6.40.132.0, it has become possible to define Global Trade Item Number (GTIN) prefixes that should be recognized by POS PRO when item tags are scanned with the RFID reader.

In CHQ, this update resulted in adding the **GTIN allowed prefixes** setting at the company and location levels.

#### Purpose

This update allows for narrowing RFID scanning down to the items that are included in the brand’s product catalog and, respectively, are registered under the defined GTIN company prefix.

That resolves the issue of error messages appearing in POS when scanning item tags with different encoding (for example, security tags).

With this feature active, item tags with GTIN prefixes not previously added in CHQ are simply ignored by POS.

#### How to set the allowed GTIN prefixes at the company level

1. In CHQ, go to `settings > sales > POS settings`.
2. In the **general** section, fill out the **GTIN allowed prefixes** field:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_gtin1.jpg" title="New GTIN allowed prefixes field" width="550px"%}}
{{% notice tip %}}
If you want to specify several prefixes, separate the values with commas, for example: `3039, 3040, … `.
{{% /notice %}}
3. **Save** your changes.

#### How to set the allowed prefixes at the location level

{{% notice note %}}
Please be advised that location-level settings override company-level settings.
{{% /notice %}}

1. Go to `settings > location settings > locations / location settings`.
2. Click to select your location, then click **edit**.
3. In the **[selected location]** dialog that opens, go to the **general settings** tab.
4. Populate the **GTIN allowed prefixes** field:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_gtin2.jpg" title="New GTIN allowed prefixes field" width="450px"%}}
{{% notice tip %}}
If you want to specify several prefixes, separate the values with commas, for example: `3039, 3040, … `.
{{% /notice %}}
5. **Save** your changes.

#### New location of "RFID allowed prefixes" setting

As a part of this update, the **RFID allowed prefixes** setting has been moved to `chq > settings > location settings > locations / location settings > [your location] > general settings > the general section`.

#### See also

- [V6.40 Mobile Release Guide](https://twdocs.netlify.app/userdoc/pos/relguides/6.40_mobile_rel_guide/)
- [Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

### Updated logic for web printing designs

`Build 6.40.156.0: DS-4097`

As of version 6.40.156.0, we’ve updated the logic for the CHQ settings available under `settings > printing > web printing designs`:
{{% gimg src="V6.40 CHQ Release Guide/640_chq_cross.jpg" width="600px"%}}

Now that a selected report design is removed on clicking the **cross** button (see the screenshot above), the default report design for this report type displays instead.

#### See also

[Cloud HQ User Manual: Settings](https://twdocs.netlify.app/userdoc/chq/manuals/ "CHQ Manual Version 6")

## Other enhancements

### JSON-based Catalog Export API: New fields added

`Build 6.40.46.0: DS-3475`

As of version 6.40.46.0, JSON-based Catalog Export API has been extended with new **StyleId** and **ItemId** fields.

The **ItemId** field is available in the **Items** array.

### JSON-based Sales Receipt Export API: ListOrder renamed to LineNo

`Build 6.40.46.0: DS-3462`

In JSON-based Sales Receipt Export API, the **ListOrder** field available in the **Salespersons** array has been renamed to **LineNo**.

### V6.36 POS PRO temporarily compatible with V6.40 CHQ

`Build 6.40.46.0: PRO-11131`

To prepare for the upgrade of clients' environments, we’ve ensured that V6.36 POS PRO can temporarily work in conjunction with V6.40 CloudHQ.

### Validate the bundle ID of the POS app

`Build 6.40.67.0: PRO-11423`

At the backend, we've validated the bundle ID of the POS app by the pattern `com.teamworkcommerce.POS6-XX`. 
{{% notice info %}}
Bundle ID uniquely identifies an application in Apple's ecosystem.
{{% /notice %}}

### Logging POS exceptions in Stackdriver

`Build 6.40.67.0: PRO-11184`

Prior to version 6.40.67.0, POS app exceptions were logged in the MobileExceptionLog table at the backend. With this update, POS exceptions are now logged in the integrated Stackdriver environment.

### Updating RecModified when customer is updated from BigQuery

`Build 6.40.84.0: PRO-11590`

When a customer attribute is changed in BigQuery, and that change is pulled to CHQ database, the **RecModified** value for the respective customer record is now updated.

### JSON-based Drawer Memo Export API: New fields added

`Build 6.40.84.0: PRO-11589`

As of version 6.40.84.0, we've extended the JSON-based Drawer Memo Export API with new **StartOfDayOverShort**, **EndOfDayOverShort** and **SpecialType** fields.

For the **SpecialType** field, the following values are possible: `Drawer`(`0`) and `Safe`(`1`).

### JSON-based Sales Receipt Full Export API: New fields added

`Build 6.40.84.0: PRO-11671`

We've added the **GiftCardType** and **GiftCardReason** fields to the **Payments** section in JSON-based Sales Receipt Full Export API.

Additionaly, to add the capability to export those values for sold Gift Cards, we've added the **GiftCardType** and **GiftCardReason** fields to the **Charge** section.

The new values are retrieved for native Teamwork gift cards only.

### Tracking ATS Quantity Changes

`Build 6.40.84.0: PRO-10781, PRO-11292, PRO-11293, PRO-11522, PRO-11523, PRO-11662`

In Teamwork Commerce PRO Suite, it is possible to track every change in the ATS quantities via a specifically designed ATS ledger.

Values in the ATS ledger are updated every time any of the respective documents (for example, Sales Receipt, Ship Memo, Purchase Receipt, etc.) is saved or deleted. Thus, it is no longer needed to go through every document and re-calculate quantities each time the information on ATS quantities is requested.

To get the up-to-date information on ATS quantities from the ATS ledger, it’s possible to create a webhook and subscribe to the **AtsLedgerChanged** event.

#### Creating the ATSLedgerChanged webhook

To create this webhook, in CHQ:

1. Go to `settings > integrations > webhooks`.
2. Click **new**.
3. In the **new webhook** dialog that opens, on the **general** tab, fill out:

    - **name**: the name of your webhook
    - **service URI**: the URI where you want to receive notifications
    - **service secret**: secret token used to secure webhooks

4. On the **events** tab, in the **select** column, select the checkbox next to the **AtsLedgerChanged** event.
5. **Save** your changes.

#### Response JSON structure

Once you are subscribed to the **AtsLedgerChanged** event, you will get a JSON document with the updates in the ATS Ledger.

Please note that this JSON will include *ALL* the changes that occurred since the previous call.

Below, you can see an example of such JSON, where the **Notifications** array includes the following information:

- **Id**: the unique ID of the document that contains all the changes in the ATS ledger
- **Action**: the name of the event
- **ModifiedDate**: the date and time when this document was formed
- **Quantities**: the array with the information on quantity changes per item
    - **ItemIdentifier**: the unique ID of the item whose quantity was changed. Upon request, can be configured to be one of the following: PLU, primary UPC, External ID, CLU
    - **LocationIdentifier**: the unique ID of the location where the change in quantities took place. Upon request, can be configured to be one of the following: Location ID, Location Code, Location Name
    - **DocumentType**: a type of the document that caused changes in ATS quantities. Can be one of the following: “sales order”, “ship memo”, “transfer order”, “sales receipt”, “purchase receipt”, “transfer memo”, “adjustment memo”, “reserve order”, “damaged memo”
    - **DocumentSubType**: if the document type is “sales order”, can be “send sale” or “web order”
    - **DocumentId**: the unique ID of the document that caused changes in ATS quantities
    - **AtsDelta**: the number denoting the change. Positive values denote increase and negative – decrease in ATS quantities
    - **Ats**: available-to-sell quantity for the respective item after the change
    - **ChangedBy**: indicates what caused the ATS change. Can be one of the following:
        - "committed" – if the ATS change was caused by the committed quantity change
        - "on hand" – if the ATS change was caused by the on-hand quantity change

### JSON-based Sales Receipt Full Export API: Updated response model

`Build 6.40.97.0: DS-3732`

We've fixed JSON-based Sales Receipt Full Export API response model. Prior to version 6.40.97.0, the model indicated integer value for the **UniversalCustomerType** field although the actual returned value is string.

### Performance optimization

`Build 6.40.97.0: DS-3714`

At the database level, we've introduced updates to prevent performance issues in `sales > order management` area of CHQ.

Additionally, improvements were made to maintain optimal performance of echo digital assets export and customer search in POS PRO.

### JSON-based Sales Receipt Import API: New WebOrderNo and DeviceTransactionNumber fields

`Build 6.40.111.0: PRO-11966`

We’ve extended JSON-based Sales Receipt Import API with new **WebOrderNo** and **DeviceTransactionNumber** fields.

The following requirements are applied to the values:

- **WebOrderNo**: alphanumeric, maximum 50 characters are allowed
- **DeviceTransactionNumber**: valid values range from 1200000001 to 1299999999. Must be unique.

### JSON-based Inventory Import API: Importing item attribute aliases

`Build 6.40.111.0: DS-3663`

We’ve extended JSON-based Inventory Import API with new **Attribute1Alias**, **Attribute2Alias**, and **Attribute3Alias** fields. These fields allow for importing alternative names of item attributes.

The **Attribute1Alias**, **Attribute2Alias**, and **Attribute3Alias** fields are optional and require string values.

### Validating the bundle ID for the mobile applications

`Build 6.40.120.0: PRO-12286`

We’ve validated the bundle ID for the mobile applications by the following patterns:

- `com.teamworkcommerce.[app name][app generation number]-[major and minor version numbers]` for version 6 applications, for example com.teamworkcommerce.POS6-40
- `com.cloudworks.[app name][app generation and major version number]-[minor version number]` for version 4 applications, for example com.cloudworks.TeamworkPOS49-3

{{% notice info %}}
Bundle ID uniquely identifies an application in Apple’s ecosystem.
{{% /notice %}}

Also, at the database level, we’ve added a new **ActualBundleId** field. The **ActualBundleId** field determines the actual bundle identificator of a device.

### New JSON-based EC ATS Milestone Export API

`Build 6.40.120.0: PRO-11961`

We’ve added a new JSON-based EC ATS Milestone Export API that allows for exporting absolute available-to-sell (ATS) item quantities.

{{% notice note %}}
Absolute ATS inventory quantities are periodically retrieved from the integrated eCommerce platform (or other external system) in order to reset ATS Ledger quantities. Importing absolute values ensures that ATS Ledger stays synchronized with the external system.
{{% /notice %}}

### JSON-based Inventory Import API: Importing Alias 2 for item attributes

`Build 6.40.132.0: DS-3901`

We’ve added new **Attribute1Alias2**, **Attribute2Alias2**, and **Attribute3Alias2** fields to the JSON-based Inventory Import API. These fields allow for importing Alias 2 (an alternative name) for item attributes.

The **Attribute1Alias2**, **Attribute2Alias2**, and **Attribute3Alias2** fields are optional and require string values.

### JSON-based Purchase Order Export API: New ShipMethodIdentifier setting

`Build 6.40.150.0: DS-4085`

As of version 6.40.150.0, we’ve extended the JSON-based Purchase Order Export API with the **ShipMethodIdentifier** setting. This setting supports the following values: `Code` (set by default), `Description`, and `TeamworkId`.

### Logs for creation of new API documents

`Build 6.40.156.0: PRO-13336`

Starting from version 6.40.156.0, when a new API document is created during JSON-based or XML-based import, the respective log record is created – ApiProcessContainer.GetNewApiDoc and ChqApiRequest< T >.CreateApiDocument.

{{% notice note %}}
Please be advised that the logs are accessible in CHQ under `settings > server tasks > app logs`.
{{% /notice %}}

## Issue resolutions

### Transfer Memo: Configuration of the display of item columns is not saved

`Build 6.40.46.0: DS-3529`

**Issue**  
When the user made changes to the display of columns under `inventory > transfer memos > [selected transfer memo] > items` (for example, made visible a column that does not display by default), those changes weren't saved when opening a different Transfer Memo.

**Resolution**  
The issue has been fixed. Now, when the user configures the display of item columns in a Transfer Memo, the changes are saved for all Transfer Memos.

### Cash payment method cannot be added for a location

`Build 6.40.67.0: DS-3521`

**Issue**  
In CHQ, users weren't able to make a Cash payment method available to a store location by doing the following:

- under `settings > sales > payment methods > [selected Cash payment method] – location settings`, selecting a location for which the Cash payment method is already configured, and then 
- using the **copy to locations** option to copy the payment method settings to another location

**Resolution**  
The issue has been fixed. Now, when **copy to locations** option is used for a payment method, the location to which the settings were copied is added to the list under `settings > sales > payment methods > [selected Cash payment method] – location settings`. Respectively, in POS, that location can utilize the Cash payment method. 

### JSON-based Vendor Invoice Export API: GUID returned instead of PONum

`Build 6.40.67.0: DS-3534`

We've fixed the issue where JSON-based Vendor Invoice Export API would return a GUID value in the PurchaseOrderIdentifier field even if *PurchaseOrderIdentifierSetting* was set to return a PONum value. 

### Zero total amount in emailed receipts

`Build 6.40.67.0: DS-3513`

We've fixed the issue where, when using V6.39 CHQ in conjunction with V4.93 POS, receipts emailed to customer via Mandrill could incorrectly show zero total amount.

### FiscalDate has the NULL value in some Sales Receipts

`Build 6.40.67.0: DS-3579`

Prior to version 6.40.67.0, at the database level, the FiscalDate field in the SalesReceipt table could be incorrectly populated with `NULL` for some records.

The issue has been fixed. Now, for all posted transactions, the FiscalDate is populated with the RecCreated value as expected.

### JSON-based Sales Receipt Full Export API: Unable to retrieve receipts by MembershipCode

`Build 6.40.67.0: DS-3549`

**Issue**  
When retrieving purchase history by the customer's MembershipCode via JSON-based Sales Receipt Full Export API, the response could sometimes return no Sales Receipts even if such Sales Receipts actually existed.

**Resolution**  
The issue has been fixed. Now, it's possible to retrieve the Sales Receipts linked to the customer by MembershipCode as expected.

### JSON-based Count Memo Scan Import API: Items rendered as unrecognized in Count Memos

`Build 6.40.84.0: DS-3666`

We've fixed the issue where multiple items from Count Memos were considered unrecognized. The issue was caused by the multiple API calls that were made simultaneously.

### Duplicate Sales Receipt against a Sales Order

`Build 6.40.97.0: DS-3727`

We’ve fixed the issue where a duplicate Sales Receipt was occasionally created against a Sales Order.

### Different Net Sales value in the Drawer Memo report and Sales Receipt Journal

`Build 6.40.111.0: DS-3723`

Prior to version 6.40.111.0, the Drawer Memo and Sales Receipt Journal reports could show different Net Sales values for cash. That happened because some receipt payment lines in Drawer Memos were duplicated.

The payment duplicate issue has been fixed. Now, the values in the Drawer Memo report are consistent with the values in Sales Receipt Journal.

### Verified Returns with duplicate DTNs

`Build 6.40.111.0: DS-3719`

**Issue**  
We’ve fixed the issue where it was possible to post two Verified Return transactions with the same Device Transaction Number (DTN) against one sale. That happened when, in POS PRO, the user started the return both under `Sales Receipts > History > [selected Sales Receipt] > Return > Trans # field – View and Sales Receipts > History > [selected Sales Receipt] > Return`.
This also resulted in the reprinted receipt having incorrect information.

**Resolution**  
To resolve this issue, in POS PRO, we removed the Return option previously available under `Sales Receipts > History > [selected Sales Receipt] > Return > Trans # field – View`. Now, as expected, it’s not possible to create two Verified Returns with the same DTN.

### JSON-based Drawer Memo Export API: The AccountType value fails to export

`Build 6.40.111.0: DS-3783`

We’ve fixed the issue where, in JSON-based Drawer Memo Export API, the **AccountType** value failed to export if **PaymentMethodIdentifier** was `CASH_ROUNDING_ADJUSTMENT`.

### Incorrect display of promo start date and end date

`Build 6.40.111.0: DS-3750`

We’ve fixed the issue where the **start date** and **end date** of a promotion displayed under `chq > sales > promotion engine > list` did not match the respective dates defined by the user upon promo creation. That happened when the time zone on the user’s device was set to UTC +02:00.

### Inability to remove Sales Receipts from hold after upgrade

`Build 6.40.111.0: DS-3763`

We’ve fixed the issue where, after a client’s POS PRO was upgraded from version 6.39 to 6.40, it was impossible to remove from hold some of the Sales Receipts that were put on hold prior to the upgrade.

### Sales Orders import failure

`Build 6.40.111.0: DS-3873`

We’ve fixed the issue where multiple Sales Orders could not be imported into CHQ due to an error in the *AutoApproveSalesOrders* task. The issue occurred because, in one of the orders, the First Name value in the ship-to address exceeded the allowed value length.

### JSON-based Sales Receipt Export API error when exporting a SR by TeamworkId

`Build 6.40.111.0: DS-3877`

Prior to version 6.40.111.0, exporting Sales Receipts via JSON-based Sales Receipt Export API could fail when, in the API request, `TeamworkId` was specified for **DrawerMemoIdentifierSetting**.

Additionally, when **DrawerMemoIdentifierSetting** was set to `WorkstationNum` or `WorkstationName`, the export was successful but the **DrawerMemoIdentifier** field was missing in the API response.

The issue has been fixed. Now, Sales Receipt export with the configurations specified above can be performed as expected.

### Payment methods not visible in V4.93 POS

`Build 6.40.123.0: DS-3920`

We’ve fixed the issue where, in V4.93.411 POS initialized to V6.40 CHQ, active payment methods failed to appear under `Sales Receipt > Payment`.

### Workstations not displaying in V4 Drawer Memo app

`Build 6.40.123.0: DS-3921`

**Issue**  
In V4.93.37 Drawer Memo app, after app initialization was completed, available workstations failed to appear in the **Select Workstation** dialog.

**Resolution**  
The issue has been fixed. Now, workstations configured in CHQ are available for selection in the Drawer Memo app as expected.

### Incorrect calculation of base currency payment amount in V4 POS

`Build 6.40.123.0: DS-3926`

We’ve fixed the issue where, in V4 POS, when taking a foreign currency payment, the payment amount in the base currency could be calculated incorrectly.

### JSON-based Drawer Memo Export API: Incorrect calculation of EndOfDayOverShort amount

`Build 6.40.132.0: DS-3947`

Prior to version 6.40.132.0, in Drawer Memos exported via JSON-based Drawer Memo Export API, the **EndOfDayOverShort** value was calculated incorrectly. In particular, the **EndOfDayOverShort** amount included amounts from created **Take In/Out** and **Move to Safe** records.

The issue has been fixed. Now, as expected, amounts added or deducted by cash movement records are not considered discrepancies in the drawer cash balance and, respectively, are not included in the calculation of the **EndOfDayOverShort** amount.

### POS app cannot be fully synchronized

`Build 6.40.132.0: DS-3932`

We’ve fixed the issue where POS PRO could fail to synchronize due to the `([fiscal].[ReceiptReprintHistory_ins]:FK violated for [ReceiptReprintHistory_t].[PreviousDuplicateId]->[[fiscal].[ReceiptReprintHistory]]` error.

### Incorrect Avalara tax jurisdiction on the printed receipt

`Build 6.40.139.0: DS-3943`

Prior to version 6.40.139.0, clients utilizing integration with Avalara in version 4.93 POS could encounter the issue where incorrect tax jurisdiction(s) would be printed on a Send Sale receipt.

This issue has been resolved. Now, as expected, correct tax jurisdictions based on the Send Sale ship-to address appear on the printed receipt.

### API calls stuck in the "in process" status

`Build 6.40.139.0: DS-3970`

Prior to version 6.40.139.0, some API calls could occasionally be stuck in the `in process` status. These API calls failed due to the timeout and were never confirmed.

The issue has been fixed. Now, when an API call is sent to CHQ and fails due to the timeout, the `error` status displays.

### Stock count: No user login in the Prepared by field

`Build 6.40.139.0: DS-3971`

**Issue**  
Reports run from `chq > inventory > stock count > [your stock count document] > review > print` could be missing the **Prepared by** value.

**Resolution**  
The issue has been fixed. Now, as expected, the **Prepared by** field is filled out with the login of the user who has run the report.

### JSON-based Customer Import API: Inability to import new customer records

`Build 6.40.139.0: DS-3956`

We’ve fixed the issue where a JSON-based Customer Import API call could be stuck in the `in process` status, resulting in no customer records imported into CHQ.

### Updated Looker API

`Build 6.40.150.0: DS-3994`

We’ve introduced changes at the database level to ensure that the updated version of Looker API is used in conjunction with CHQ.

### Unable to access Looker dashboards

`Build 6.40.150.0: DS-3479`

We’ve fixed the issue where running any dashboard under `chq > analytics > dashboards` could occasionally display an empty page. This happened due to the update of the dashboard routes on the Looker side.

### Duplicate scans in Count Memos

`Build 6.40.150.0: DS-4076`

We’ve fixed the issue where Count Memos could occasionally contain duplicate item scans instead of ignoring duplicate EPCs.

### Searching Sales Receipts in POS is not possible due to timeout

`Build 6.40.150.0: DS-3768`

We’ve fixed the issue where searching Sales Receipts in Teamwork POS PRO Version 6 could occasionally fail due to timeout.

### Gift Cards unavailable in POS Version 4

`Build 6.40.150.0: DS-4081`

We’ve fixed the issue where Gift Cards could occasionally become unavailable in Teamwork POS Version 4 due to the missing currency information at the database level. The issue occurred after upgrading CHQ from version 6.17 to 6.40 in conjunction with POS V4.

### Inability to search for customers in POS Version 4

`Build 6.40.150.0: DS-4061`

We’ve fixed the issue where searching for customers could occasionally fail with the `Server Unavailable` error message in the **Customer** and **Customer Search** areas under **Sales Receipt** in Teamwork POS Version 4. The issue occurred after upgrading CHQ from version 6.17 to 6.40 that works in conjunction with POS Version 4.

### Incorrect Offer Price for returns

`Build 6.40.156.0: DS-4118`

Prior to 6.40.156.0, the offer price for the returns could occasionally be positive in Sales Receipts created in Teamwork POS Version 4. The issue occurred after upgrading CHQ from version 6.17 to 6.40 which works in conjunction with POS Version 4.
The issue has been fixed. Now, the offer price is negative for the returns as expected.

### Performance enhancements related to webhooks

`Build 6.40.156.0: PRO-10875`

At the database level, we’ve performed optimizations related to the webhook functionality.

### JSON-based Secure Customer Export API: Incorrect value returned in CountryIdentifier

`Build 6.40.159.0: DS-4115`

**Issue**  
Prior to 6.40.159.0, when executing the JSON-based Secure Customer Export API call with the **CountryIdentifierSetting** set to `Code`, the **CountryIdentifier** value in the API response occasionally didn’t match the value defined for the customer in the **country** field under `chq > sales > customers > [selected customer] > ship to > [selected ship to address] > edit`.

**Resolution**  
The issue has been fixed. Now, the **CountryIdentifier** value in the API response matches the value from CHQ as expected.

### Customer membership recalculated on a wrong date

`Build 6.40.165.0: DS-4223`

We’ve fixed the issue where the customer membership could occasionally be recalculated one day after the specified recalculation day.

{{% notice note %}}
Please note the membership calculation settings are available for configuration under `chq > settings > customer > membership calculation`.
{{% /notice %}}

### Creating new EC ATS Control Orders is blocked by purging old records

`Build 6.40.165.0: DS-4194`

We’ve fixed the issue where purging old records by the **EcommQtyEchoTablePurge** job could occasionally block creation of new EC ATS Control Orders.

## Impacted Areas

Teamwork Commerce PRO Suite allows for unique client-specific configurations. If the above is your case, we recommend that the areas and workflows listed below be additionally checked to ensure the existing functionality works as expected in conjunction with the newly released features.

{{% notice note %}}
Please be advised that the information below does not include details on the configurations and conditions required for testing the new features. For detailed information, see the respective feature description in this release guide.
{{% /notice %}}

|Feature| Impact|
|-------|-------|
|Extended search for customer records|In POS, test customer search by External ID in the Customers and Sales Receipt > Customer areas.|
|Configuring the display of Sales Receipt details on Adyen terminal| In CHQ, enable the display of receipt details on Adyen terminal. In POS, test workflows related to Sales Receipt creation and finalization with a connected Adyen terminal.|
|Automatic RFID network connection| Test workflows related to using an RFID reader with POS PRO. Pay attention to how RFID network connection changes when the Ethernet cable is plugged into or unplugged from the device.|
Givex gift cards: Extended capabilities|In CHQ, test workflows related to setting up Givex gift cards: <ul><li> define Givex as the gift card processor for physical gift cards in inventory as well as for Check Balance payment method</li><li> define balance limits for Givex gift cards.</li></ul>|
Configuring settings for return Gift Cards|In CHQ, configure settings for return gift card generation. In POS, test workflows related to making a refund to a gift card. Pay attention to how the return gift cards settings are used for generation of a refund gift card. Check the workflows related to issuing return virtual gift cards as a part of Returns Manager functionality.|
New transaction email type: Return Virtual Gift Card Delivery|In CHQ, set up the Return Virtual Gift Card Delivery email type. In POS, test workflows related to issuing a Virtual Gift Card as a means of refund. Pay attention to how the new transaction email is sent out if the user chooses to email the return gift card.|
Updated tag printing settings|In CHQ, configure the Tag Printing area in the V6 App Designer. In POS, test workflows related to printing item tags from the following documents:<ul><li>Transfer Order, Transfer In, Transfer Out</li><li>Purchase Order, Purchase Receipt</li><li>Adjustment Memo</li></ul> Pay attention to how the layout of the Print Tags area corresponds with configurations in V6 App Designer.|
New security right for removing promotions|In CHQ, grant a user with the new security right. In POS, test workflows related to removing a promotion from the Sales Receipt.|
Configuring additional user login for performing returns|In CHQ, enable additional user login for returns. In POS, test workflows related to Open and Verified Returns.|
Auto-issuing coupons to new customers|At the fiscal zone level, create an event that allows for issuing coupons to newly created customers. Then, create a new customer in the respective fiscal zone and check that the coupon is linked to the customer's record.|
New security right for placing Adjustment Memos on hold| In CHQ, grant a user with the new security right. In POS, test workflows related to placing Adjustment Memos on hold.|
ShippyPro: Sending a “close” call for the shipment|In CHQ, enable require closing setting. In POS, test workflows related to finalization of a Ship Memo with ShippyPro. Check that the closing call is received by ShippyPro, and no additional fees are applied to the shipment.|
New security rights for changing validation on customer fields|In CHQ, grant a user with the new security right. In POS, test workflows related to creating new or editing existing customer records. Check that the user is able to edit the Validation fields in customer records.|
Updated Customer URL field|In CHQ, configure a custom name for the Customer URL field. In POS, test adding a customer with defined Customer URL field to a Sales Receipt. Check how the Custom URL field displays in the added customer record.|
Support of eCommerce Reserve Orders| Test workflows related to processing an imported Reserve Order (RO). Pay attention to the push notifications about new imported ROs as well as the default expiration date in an imported RO.|
Configuring allowed GTIN prefixes|In CHQ, define allowed GTIN prefixes. In POS, test workflows related to scanning item tags with an RFID reader. Check that item tags that do not include an allowed GTIN prefix are ignored by POS.|

{{% notice warning %}}
WE DO NOT WARRANT AND SHALL NOT BE RESPONSIBLE FOR THE PERFORMANCE OF ANY THIRD-PARTY VENDOR’S PRODUCTS OR SERVICES. ALL SOFTWARE AND HARDWARE IS ACQUIRED SUBJECT TO THE END USER LICENSE AGREEMENT, WARRANTY, AND OTHER TERMS PROVIDED BY THE MANUFACTURER OR SUPPLIER OF SUCH THIRD-PARTY PRODUCT.   YOU AGREE TO BE BOUND BY AND COMPLY WITH ANY SUCH MANUFACTURER LICENSE AGREEMENT, WARRANTY, OR OTHER TERMS AND CONDITIONS, AND YOU UNDERSTAND AND AGREE TO LOOK SOLELY TO THE THIRD-PARTY VENDOR OF THE PRODUCT FOR MAINTENANCE AND SUPPORT, INCLUDING BUT NOT LIMITED TO RESOLUTION OF SYSTEM ERRORS, BUGS, PATCHES, HOT FIXES, ETC. YOUR SOLE AND EXCLUSIVE RIGHTS AND REMEDIES WITH RESPECT TO ANY THIRD-PARTY PRODUCT OR SERVICE, INCLUDING RIGHTS AND REMEDIES IN THE EVENT A THIRD-PARTY PRODUCT OR SERVICE GIVES RISE TO AN INFRINGEMENT CLAIM, WILL BE AGAINST THE THIRD-PARTY VENDOR AND NOT AGAINST US.

TO THE MAXIMUM EXTENT PERMITTED BY LAW, WE DISCLAIM ANY AND ALL PROMISES, REPRESENTATIONS, AND WARRANTIES, EXPRESS OR IMPLIED, WITH RESPECT TO THE VERSION OF THE PROGRAM SET FORTH HEREIN, SPECIFICALLY INCLUDING ANY UNDERLYING THIRD PARTY TECHNOLOGIES AND/OR PLATFORMS USED IN CONJUNCTION WITH SAME, MATERIALS AND ANY OTHER DATA, INFORMATION, OR OTHER MATERIAL FURNISHED TO USER HEREUNDER, INCLUDING, WITHOUT LIMITATION, THE CONDITION THEREOF; AND WARRANTIES OF NON-INFRINGEMENT, TITLE, MERCHANTABILITY, OR FITNESS FOR A PARTICULAR PURPOSE OR USE.
{{% /notice %}}

<br>

[OPEN PDF](https://storage.googleapis.com/twc-pedia-prod-bucket/pdf/relguides/CHQ%20Release%20Guide%20Version%206.40.165.0.pdf)
